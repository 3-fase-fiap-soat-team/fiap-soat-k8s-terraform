# üöÄ FIAP SOAT - Sistema de Fast Food

**Infraestrutura como C√≥digo para Kubernetes na AWS**

[![Deploy EKS](https://github.com/3-fase-fiap-soat-team/fiap-soat-k8s-terraform/actions/workflows/deploy-app.yml/badge.svg?branch=main)](https://github.com/3-fase-fiap-soat-team/fiap-soat-k8s-terraform/actions/workflows/deploy-app.yml)
[![Terraform](https://img.shields.io/badge/Terraform-1.5+-623CE4?logo=terraform)](https://www.terraform.io/)
[![AWS EKS](https://img.shields.io/badge/AWS-EKS%201.30-FF9900?logo=amazon-aws)](https://aws.amazon.com/eks/)
[![Kubernetes](https://img.shields.io/badge/Kubernetes-1.30-326CE5?logo=kubernetes)](https://kubernetes.io/)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

---

## üìã √çndice

- [Sobre o Projeto](#-sobre-o-projeto)
- [Arquitetura](#-arquitetura)
- [Stack Tecnol√≥gica](#-stack-tecnol√≥gica)
- [Pr√©-requisitos](#-pr√©-requisitos)
- [Como Deployar](#-como-deployar)
- [Guia Completo de Testes](#-guia-completo-de-testes)
- [Estrutura do Reposit√≥rio](#-estrutura-do-reposit√≥rio)
- [Comandos √öteis](#-comandos-√∫teis)
- [Branches e Reposit√≥rios](#-branches-e-reposit√≥rios)
- [Equipe](#-equipe)

---

## üìñ Sobre o Projeto

Este projeto implementa a **infraestrutura completa de um sistema de fast food** utilizando:

- **Amazon EKS (Elastic Kubernetes Service)** para orquestra√ß√£o de containers
- **Terraform** para provisionamento de infraestrutura como c√≥digo
- **AWS RDS PostgreSQL** para persist√™ncia de dados
- **AWS Lambda + API Gateway + Cognito** para autentica√ß√£o serverless
- **Network Load Balancer** para exposi√ß√£o da aplica√ß√£o NestJS

O projeto foi desenvolvido como parte do curso **FIAP SOAT - Fase 3**, com foco em:
- Arquitetura de microsservi√ßos
- Clean Architecture
- CI/CD automatizado
- Otimiza√ß√£o de custos para AWS Academy ($50 USD budget)

---

## üèóÔ∏è Arquitetura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        AWS Cloud (us-east-1)                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  API Gateway (REST API)                                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ POST /signup  ‚Üí Lambda fastfoodSignup                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ POST /auth    ‚Üí Lambda fastfoodAuth                       ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                          ‚Üì                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  AWS Cognito User Pool (fastfood-users)                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ Custom Attribute: CPF                                     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                          ‚Üì                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Network Load Balancer (NLB)                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ Port 80 ‚Üí EKS Service (fiap-soat-application-service)    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                          ‚Üì                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  EKS Cluster (fiap-soat-eks-dev) - Kubernetes 1.30           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ Namespace: fiap-soat-app                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ Deployment: fiap-soat-application (HPA: 1-3 replicas)    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ Service: LoadBalancer tipo NLB                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ ConfigMap + Secrets                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                          ‚Üì                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  RDS PostgreSQL 17.4 (fiap-soat-db)                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ Inst√¢ncia: db.t3.micro                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ Storage: 20 GB gp3                                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ VPC: vpc-0b339aae01a928665                               ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  VPC & Networking (Auto-discovered via RDS)                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ 6 Subnets (3 p√∫blicas, 3 privadas)                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ Security Groups (EKS Cluster + Nodes + RDS)              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ IAM Roles: LabEksClusterRole, LabEksNodeRole             ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Fluxo de Autentica√ß√£o

1. Cliente ‚Üí **API Gateway** (`/signup` ou `/auth`)
2. **Lambda** processa requisi√ß√£o
3. **Lambda** cria/valida usu√°rio no **NestJS** via **Load Balancer**
4. **NestJS** persiste dados no **RDS PostgreSQL**
5. **Lambda** cria/valida usu√°rio no **Cognito**
6. **Lambda** gera **JWT token** e retorna ao cliente

---

## üõ†Ô∏è Stack Tecnol√≥gica

### Infraestrutura
- **Terraform** (v1.0+) - Infrastructure as Code
- **AWS EKS** (v1.30) - Kubernetes gerenciado
- **AWS RDS** (PostgreSQL 17.4) - Banco de dados relacional
- **AWS Lambda** (Node.js 20.x) - Fun√ß√µes serverless
- **AWS API Gateway** - REST API
- **AWS Cognito** - Gerenciamento de identidades
- **AWS NLB** - Network Load Balancer

### Aplica√ß√£o
- **NestJS** - Framework Node.js com Clean Architecture
- **TypeScript** - Linguagem principal
- **Docker** - Containeriza√ß√£o
- **Kubernetes** - Orquestra√ß√£o de containers

### DevOps
- **GitHub Actions** - CI/CD
- **kubectl** - CLI do Kubernetes
- **AWS CLI** - CLI da AWS
- **Artillery & K6** - Testes de carga

---

## üì¶ Pr√©-requisitos

### Ferramentas Necess√°rias

```bash
# Terraform (>= 1.0)
terraform version

# kubectl
kubectl version --client

# AWS CLI
aws --version

# Git
git --version
```

### Conta AWS
- **AWS Academy Learner Lab** ativo
- **Budget**: $50 USD
- **Regi√£o**: us-east-1
- **Credenciais**: Renovar a cada ~3 horas

---

## üöÄ Como Deployar

### 1Ô∏è‚É£ Clonar o Reposit√≥rio

```bash
git clone https://github.com/3-fase-fiap-soat-team/fiap-soat-k8s-terraform.git
cd fiap-soat-k8s-terraform
```

### 2Ô∏è‚É£ Configurar Credenciais AWS Academy

```bash
./scripts/aws-config.sh
```

Cole as credenciais do AWS Academy quando solicitado no formato:

```
aws_access_key_id=ASIAUCQMSWOI2CB3BP3S
aws_secret_access_key=ey3nbFY1QZeN57JZC3n0QlGq733TW/bv7fnpSxBr
aws_session_token=IQoJb3JpZ2luX2VjEDgaC...
```

Pressione `Ctrl+D` para finalizar.

### 3Ô∏è‚É£ Configurar Vari√°veis do Terraform

```bash
cd environments/dev
cp terraform.tfvars.example terraform.tfvars
```

Edite `terraform.tfvars` se necess√°rio (valores padr√£o j√° est√£o otimizados).

### 4Ô∏è‚É£ Provisionar Infraestrutura EKS

```bash
# Inicializar Terraform
terraform init

# Visualizar plano de execu√ß√£o
terraform plan

# Aplicar configura√ß√£o (‚ö†Ô∏è Cuidado com custos!)
terraform apply
```

Aguarde ~10-15 minutos para o cluster EKS ficar pronto.

### 5Ô∏è‚É£ Configurar kubectl

```bash
aws eks update-kubeconfig --region us-east-1 --name fiap-soat-eks-dev
kubectl get nodes
```

### 6Ô∏è‚É£ Deployar Aplica√ß√£o NestJS

```bash
cd ../../
kubectl apply -f manifests/
```

Verifique o deploy:

```bash
kubectl get pods -n fiap-soat-app
kubectl get service -n fiap-soat-app
```

Aguarde ~3 minutos para o Load Balancer ficar pronto.

### 7Ô∏è‚É£ Testar a Aplica√ß√£o

```bash
# Obter endpoint do Load Balancer
export LB_URL=$(kubectl get service -n fiap-soat-app fiap-soat-application-service \
  -o jsonpath='{.status.loadBalancer.ingress[0].hostname}')

# Testar health check
curl http://$LB_URL/health

# Swagger UI (Documenta√ß√£o Interativa)
echo "http://$LB_URL/docs"

# Testar endpoint de produtos
curl http://$LB_URL/products
```

### 8Ô∏è‚É£ (Opcional) Deployar Lambda + Cognito

Consulte o reposit√≥rio [fiap-soat-lambda](https://github.com/3-fase-fiap-soat-team/fiap-soat-lambda) branch `feat-rafael`.

---

## üß™ Guia Completo de Testes

Para testes mais detalhados (fluxo de autentica√ß√£o, pedidos, testes de carga, HPA), consulte:
- **[üìñ Guia Completo de Testes](docs/TESTING-GUIDE.md)** - Passo-a-passo detalhado
- **[üîÑ Estrat√©gia CI/CD](docs/CI-CD-SEPARATION.md)** - Separa√ß√£o de responsabilidades
- **[üîê Gerenciamento de Secrets](docs/SECRETS-MANAGEMENT.md)** - Como gerenciar credenciais

### Quick Test: Fluxo Completo

```bash
# 1. Health Check
curl http://$LB_URL/health

# 2. Cadastrar cliente (API Gateway + Lambda)
export API_URL="https://nlxpeaq6w0.execute-api.us-east-1.amazonaws.com/dev"
curl -X POST $API_URL/signup \
  -H "Content-Type: application/json" \
  -d '{"cpf":"12345678900","name":"Jo√£o Silva","email":"joao@test.com"}'

# 3. Autenticar
curl -X POST $API_URL/auth \
  -H "Content-Type: application/json" \
  -d '{"cpf":"12345678900"}'

# 4. Consultar produtos
curl http://$LB_URL/products

# 5. Monitorar HPA
kubectl get hpa -n fiap-soat-app -w
```

---

## üìÅ Estrutura do Reposit√≥rio

```
fiap-soat-k8s-terraform/
‚îú‚îÄ‚îÄ environments/
‚îÇ   ‚îî‚îÄ‚îÄ dev/
‚îÇ       ‚îú‚îÄ‚îÄ main.tf              # Configura√ß√£o principal
‚îÇ       ‚îú‚îÄ‚îÄ variables.tf         # Vari√°veis de entrada
‚îÇ       ‚îú‚îÄ‚îÄ outputs.tf           # Outputs (cluster endpoint, etc)
‚îÇ       ‚îî‚îÄ‚îÄ terraform.tfvars     # Valores das vari√°veis
‚îÇ
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îî‚îÄ‚îÄ eks/
‚îÇ       ‚îú‚îÄ‚îÄ cluster.tf           # Cluster EKS + IAM roles
‚îÇ       ‚îú‚îÄ‚îÄ variables.tf         # Vari√°veis do m√≥dulo
‚îÇ       ‚îî‚îÄ‚îÄ outputs.tf           # Outputs do m√≥dulo
‚îÇ
‚îú‚îÄ‚îÄ manifests/
‚îÇ   ‚îú‚îÄ‚îÄ namespace.yaml           # Namespace fiap-soat-app
‚îÇ   ‚îú‚îÄ‚îÄ configmap.yaml           # Configura√ß√µes da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ secret.example.yaml      # Template de secrets (n√£o commitar secret.yaml!)
‚îÇ   ‚îú‚îÄ‚îÄ deployment.yaml          # Deploy NestJS (gerenciado pelo repo da aplica√ß√£o)
‚îÇ   ‚îú‚îÄ‚îÄ service.yaml             # Service LoadBalancer (NLB)
‚îÇ   ‚îî‚îÄ‚îÄ hpa.yaml                 # Horizontal Pod Autoscaler (1-3 replicas)
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ aws-config.sh            # Configurar credenciais AWS
‚îÇ   ‚îú‚îÄ‚îÄ deploy.sh                # Deploy automatizado
‚îÇ   ‚îú‚îÄ‚îÄ deploy-from-ecr.sh       # Deploy de imagem ECR
‚îÇ   ‚îî‚îÄ‚îÄ force-destroy.sh         # Destruir recursos
‚îÇ
‚îú‚îÄ‚îÄ load-tests/
‚îÇ   ‚îú‚îÄ‚îÄ artillery/               # Testes de carga Artillery
‚îÇ   ‚îî‚îÄ‚îÄ k6/                      # Testes de carga K6
‚îÇ
‚îú‚îÄ‚îÄ docs/                        # Documenta√ß√£o t√©cnica detalhada
‚îÇ
‚îî‚îÄ‚îÄ README.md                    # Este arquivo
```

---

## üíª Comandos √öteis

### Kubernetes

```bash
# Listar todos os recursos no namespace
kubectl get all -n fiap-soat-app

# Ver logs da aplica√ß√£o
kubectl logs -n fiap-soat-app -l app=fiap-soat-application -f

# Descrever pod (troubleshooting)
kubectl describe pod -n fiap-soat-app <pod-name>

# Port-forward para testes locais
kubectl port-forward -n fiap-soat-app service/fiap-soat-application-service 3000:80

# Ver status do HPA (autoscaling)
kubectl get hpa -n fiap-soat-app

# Reiniciar deployment
kubectl rollout restart deployment -n fiap-soat-app fiap-soat-application
```

### Terraform

```bash
# Ver estado atual
terraform show

# Ver outputs
terraform output

# Destruir infraestrutura (‚ö†Ô∏è CUIDADO)
terraform destroy

# Formatar c√≥digo
terraform fmt -recursive

# Validar configura√ß√£o
terraform validate
```

### AWS CLI

```bash
# Verificar cluster EKS
aws eks describe-cluster --name fiap-soat-eks-dev --region us-east-1

# Listar nodes
aws eks list-nodegroups --cluster-name fiap-soat-eks-dev --region us-east-1

# Verificar RDS
aws rds describe-db-instances --query 'DBInstances[0].Endpoint'

# Renovar credenciais (a cada ~3h)
./scripts/aws-config.sh
```

### Testes de Carga

```bash
# Artillery (smoke test)
cd load-tests/artillery
artillery run smoke-test.yml

# K6 (stress test)
cd load-tests/k6
k6 run stress-test.js
```

---

## üåø Branches e Reposit√≥rios

### Reposit√≥rio Principal (EKS/Terraform)
- **Repo**: [fiap-soat-k8s-terraform](https://github.com/3-fase-fiap-soat-team/fiap-soat-k8s-terraform)
- **Branch Principal**: `main`
- **Respons√°vel**: rs94458 (Dev 3)
- **Conte√∫do**: Infraestrutura EKS, Terraform, Kubernetes manifests

### Reposit√≥rio Lambda (Autentica√ß√£o Serverless)
- **Repo**: [fiap-soat-lambda](https://github.com/3-fase-fiap-soat-team/fiap-soat-lambda)
- **Branch Funcional**: `feat-rafael` ‚úÖ **Deployado e testado**
- **Branch Original**: `feat/lambda-e-cognito`
- **Respons√°vel**: rs94458 (Dev 3)
- **Conte√∫do**: Lambda Functions (signup, auth), API Gateway, Cognito

### Reposit√≥rio Aplica√ß√£o (NestJS)
- **Repo**: [fiap-soat-application](https://github.com/3-fase-fiap-soat-team/fiap-soat-application)
- **Branch Principal**: `main`
- **Arquitetura**: Clean Architecture + Domain-Driven Design
- **Conte√∫do**: Aplica√ß√£o NestJS com endpoints de produtos, clientes, pedidos

---

## üí∞ Otimiza√ß√£o de Custos (AWS Academy)

### Recursos Ativos
- **EKS Control Plane**: ~$73/m√™s
- **RDS db.t3.micro**: ~$15.50/m√™s
- **Network Load Balancer**: ~$22/m√™s
- **EC2 t3.micro (2 nodes)**: ~$15/m√™s
- **Total Estimado**: ~$125.50/m√™s ‚ö†Ô∏è *Excede budget de $50*

### Recomenda√ß√µes
- ‚úÖ **Sempre destruir recursos quando n√£o estiver usando**
- ‚úÖ **Usar apenas 1 node** (`node_group_desired_size = 1`)
- ‚úÖ **Desabilitar cluster fora do hor√°rio de desenvolvimento**
- ‚ö†Ô∏è **EKS Control Plane √© o maior custo** ($2.40/dia)

```bash
# Destruir tudo para economizar
cd environments/dev
terraform destroy --auto-approve
```

---

## üë• Equipe

**Projeto**: FIAP SOAT - Fase 3  
**Organiza√ß√£o**: [3-fase-fiap-soat-team](https://github.com/3-fase-fiap-soat-team)  
**Respons√°vel Infraestrutura**: rs94458 (Dev 3)

### Reposit√≥rios do Projeto
- üèóÔ∏è [fiap-soat-k8s-terraform](https://github.com/3-fase-fiap-soat-team/fiap-soat-k8s-terraform) - Infraestrutura EKS
- üîê [fiap-soat-lambda](https://github.com/3-fase-fiap-soat-team/fiap-soat-lambda) - Autentica√ß√£o Serverless
- üçî [fiap-soat-application](https://github.com/3-fase-fiap-soat-team/fiap-soat-application) - Aplica√ß√£o NestJS

---

## üìû Suporte

Para d√∫vidas ou problemas:
1. Consulte a [documenta√ß√£o detalhada](docs/)
2. Verifique [AWS Academy Setup Guide](docs/AWS-ACADEMY-SETUP.md)
3. Abra uma [issue no GitHub](https://github.com/3-fase-fiap-soat-team/fiap-soat-k8s-terraform/issues)

---

## üìù Licen√ßa

Este projeto √© parte do curso **FIAP SOAT - Arquitetura de Software**.  
Desenvolvido para fins acad√™micos.

---

**üéì Otimizado para AWS Academy** | **üöÄ Pronto para Produ√ß√£o** | **üìä Econ√¥mico**
